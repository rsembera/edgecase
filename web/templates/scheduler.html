{% extends "base.html" %}

{% block title %}Scheduler - EdgeCase Equalizer{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/scheduler.css') }}">
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/scheduler.js') }}"></script>
{% endblock %}

{% block content %}
<div class="card">
    <div class="scheduler-header">
        <div>
            <h2>Scheduler</h2>
            <p style="color: #718096; margin-top: 0.5rem;">{{ appointment_count }} appointment{% if appointment_count != 1 %}s{% endif %} scheduled</p>
        </div>
        <a href="{{ url_for('clients.index') }}" class="btn">‚Üê Back to Clients</a>
    </div>
    
    <!-- Date Navigation -->
    <div class="controls-bar">
        <div class="date-nav">
            <a href="{{ url_for('scheduler.scheduler', date=prev_date) }}" class="nav-btn">
                <i data-lucide="chevron-left" style="width: 18px; height: 18px;"></i>
            </a>
            <div class="current-date">{{ display_date }}</div>
            <a href="{{ url_for('scheduler.scheduler', date=next_date) }}" class="nav-btn">
                <i data-lucide="chevron-right" style="width: 18px; height: 18px;"></i>
            </a>
            {% if view_date != today %}
            <a href="{{ url_for('scheduler.scheduler') }}" class="btn" style="margin-left: 1rem;">Today</a>
            {% endif %}
        </div>
    </div>
    
    <!-- Appointments List -->
    {% if appointments %}
    <div class="appointments-list">
        {% for appt in appointments %}
        <div class="appointment-card" style="border-left: 4px solid {{ appt.type_color }}; background: {{ appt.bubble_color }};">
            <div class="appointment-time">
                <div class="time-display">{{ appt.appointment_time }}</div>
                {% if appt.duration %}
                <div class="duration">{{ appt.duration }} min</div>
                {% endif %}
            </div>
            
            <div class="appointment-client">
                <a href="{{ url_for('clients.client_file', client_id=appt.client_id) }}" class="client-name">
                    {{ appt.last_name }}, {{ appt.first_name }}{% if appt.middle_name %} {{ appt.middle_name }}{% endif %}
                </a>
                <div class="file-number">{{ appt.file_number }}</div>
            </div>
            
            <div class="appointment-contact">
                {% if appt.preferred_contact == 'email' and appt.email %}
                    <span class="contact-method"><i data-lucide="mail" style="width: 14px; height: 14px;"></i> {{ appt.email }}</span>
                {% elif appt.preferred_contact == 'text' and appt.text_number %}
                    <span class="contact-method"><i data-lucide="message-circle" style="width: 14px; height: 14px;"></i> {{ appt.text_number }}</span>
                {% elif appt.preferred_contact == 'call_cell' and appt.phone %}
                    <span class="contact-method"><i data-lucide="phone" style="width: 14px; height: 14px;"></i> {{ appt.phone }}</span>
                {% elif appt.preferred_contact == 'call_home' and appt.home_phone %}
                    <span class="contact-method"><i data-lucide="phone" style="width: 14px; height: 14px;"></i> {{ appt.home_phone }}</span>
                {% elif appt.preferred_contact == 'call_work' and appt.work_phone %}
                    <span class="contact-method"><i data-lucide="phone" style="width: 14px; height: 14px;"></i> {{ appt.work_phone }}</span>
                {% elif appt.phone %}
                    <span class="contact-method"><i data-lucide="phone" style="width: 14px; height: 14px;"></i> {{ appt.phone }}</span>
                {% elif appt.email %}
                    <span class="contact-method"><i data-lucide="mail" style="width: 14px; height: 14px;"></i> {{ appt.email }}</span>
                {% else %}
                    <span class="contact-method" style="color: #9CA3AF;">No contact info</span>
                {% endif %}
            </div>
            
            <div class="appointment-actions">
                {% if appt.meet_link %}
                <a href="{{ appt.meet_link }}" target="_blank" class="action-btn meet-btn" title="Join Meeting">
                    <i data-lucide="video" style="width: 16px; height: 16px;"></i>
                </a>
                {% endif %}
                <button onclick="cancelAppointment({{ appt.id }}, '{{ appt.last_name }}, {{ appt.first_name }}')" class="action-btn cancel-btn" title="Cancel Appointment">
                    <i data-lucide="x" style="width: 16px; height: 16px;"></i>
                </button>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="no-appointments">
        <i data-lucide="calendar-off" style="width: 48px; height: 48px; color: #9CA3AF; margin-bottom: 1rem;"></i>
        <h3>No appointments scheduled</h3>
        <p>No sessions scheduled for {{ display_date|lower }}.</p>
    </div>
    {% endif %}
</div>
{% endblock %}