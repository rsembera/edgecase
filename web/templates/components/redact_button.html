<!-- Redaction button and modal - include in entry forms -->
<!-- Required: entry object with id, locked, is_redacted, statement_id -->
<!-- Required: client object with id -->

{% if is_edit and entry.locked and not entry.is_redacted and not entry.statement_id %}
<button type="button" class="btn btn-danger btn-sm" onclick="showRedactModal()">
    <i data-lucide="shield-alert" class="icon-sm"></i> Redact
</button>

<!-- Redaction Confirmation Modal -->
<div id="redact-modal" class="modal-overlay" style="display: none;">
    <div class="modal-content">
        <h3><i data-lucide="alert-triangle" class="icon-sm" style="color: #dc2626;"></i> Confirm Redaction</h3>
        <p>This will <strong>permanently remove all content</strong> from this entry. The entry will be marked as [REDACTED] and cannot be restored.</p>
        <form method="POST" action="{{ url_for('entries.redact_entry', client_id=client.id, entry_id=entry.id) }}" id="redact-form">
            <div class="form-group">
                <label for="redact-reason">Reason for redaction *</label>
                <input type="text" id="redact-reason" name="reason" required minlength="10" 
                       placeholder="e.g., Entry created in wrong client file">
                <small class="text-muted">Minimum 10 characters</small>
            </div>
            <div class="modal-actions">
                <button type="button" class="btn btn-secondary" onclick="hideRedactModal()">Cancel</button>
                <button type="submit" class="btn btn-danger">Redact Entry</button>
            </div>
        </form>
    </div>
</div>

<script>
function showRedactModal() {
    document.getElementById('redact-modal').style.display = 'flex';
    document.getElementById('redact-reason').focus();
}

function hideRedactModal() {
    document.getElementById('redact-modal').style.display = 'none';
    document.getElementById('redact-reason').value = '';
}

// Close on escape
document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
        hideRedactModal();
    }
});

// Close on overlay click
document.getElementById('redact-modal').addEventListener('click', function(e) {
    if (e.target === this) {
        hideRedactModal();
    }
});
</script>
{% endif %}
