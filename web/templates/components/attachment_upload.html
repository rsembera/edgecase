<!-- Attachment Upload Component -->
<!-- Create as: ~/edgecase/web/templates/components/attachment_upload.html -->

<div class="attachments-section">
    <h4 style="color: #111827; font-size: 1rem; margin-bottom: 0.5rem; font-weight: 600;">Attachments</h4>
    
    <!-- Existing attachments list -->
    {% if attachments %}
    <div class="attachment-list" style="margin-bottom: 1rem;">
        {% for attachment in attachments %}
        <div class="attachment-item" style="display: flex; align-items: center; padding: 0.75rem; background: #F9FAFB; border-radius: 0.5rem; margin-bottom: 0.5rem; border: 1px solid #E5E7EB;">
            <span style="flex: 1; display: flex; align-items: center; gap: 0.5rem;">
                <i data-lucide="paperclip" style="width: 18px; height: 18px; vertical-align: middle; color: #6B7280;"></i>
                <div>
                    <strong style="color: #111827;">{{ attachment.filename }}</strong>
                    {% if attachment.description != attachment.filename %}
                    <div style="color: #6B7280; font-size: 0.875rem;">{{ attachment.description }}</div>
                    {% endif %}
                    <span style="color: #9CA3AF; font-size: 0.75rem;">
                        {{ "%.1f"|format(attachment.filesize / 1024) }} KB
                        â€¢ Uploaded {{ attachment.uploaded_at|timestamp_to_date }}
                    </span>
                </div>
            </span>
            <div style="display: flex; gap: 0.5rem;">
                <a href="{{ url_for('entries.download_attachment', attachment_id=attachment.id) }}" 
                   class="btn-small" 
                   style="padding: 0.375rem 1.2rem; font-size: 0.875rem; background: #9FCFC0; color: white; text-decoration: none; border-radius: 0.375rem; border: none; cursor: pointer;">
                    Download
                </a>
                {% if allow_delete %}
                <form method="POST" action="{{ url_for('entries.delete_attachment', attachment_id=attachment.id) }}" 
                      style="display: inline; margin: 0;" 
                      onsubmit="return confirm('Delete this attachment?');">
                    <button type="submit" 
                            class="btn-small btn-danger" 
                            style="padding: 0.375rem 0.75rem; font-size: 0.875rem; background: #DC2626; color: white; border-radius: 0.375rem; border: none; cursor: pointer;">
                        Delete
                    </button>
                </form>
                {% endif %}
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <p style="color: #6B7280; font-size: 0.875rem; margin-bottom: 1rem;">No attachments yet.</p>
    {% endif %}
    
    <!-- Upload form (only if allowed) -->
    {% if allow_upload %}
    <form method="POST" 
          action="{{ url_for('upload_attachment', entry_id=entry.id) }}" 
          enctype="multipart/form-data" 
          class="upload-form"
          style="background: #F3F4F6; padding: 1rem; border-radius: 0.5rem; border: 2px dashed #D1D5DB;">
        <div style="display: flex; gap: 0.75rem; align-items: end; flex-wrap: wrap;">
            <div style="flex: 1; min-width: 200px;">
                <label for="file" style="display: block; margin-bottom: 0.25rem; font-size: 0.875rem; color: #374151; font-weight: 500;">
                    Choose file
                </label>
                <input type="file" 
                       id="file" 
                       name="file" 
                       required
                       style="width: 100%; padding: 0.5rem; border: 1px solid #D1D5DB; border-radius: 0.375rem; background: white; font-size: 0.875rem;">
            </div>
            <div style="flex: 2; min-width: 250px;">
                <label for="description" style="display: block; margin-bottom: 0.25rem; font-size: 0.875rem; color: #374151; font-weight: 500;">
                    Description (optional)
                </label>
                <input type="text" 
                       id="description" 
                       name="description" 
                       placeholder="Brief description of the file"
                       style="width: 100%; padding: 0.5rem; border: 1px solid #D1D5DB; border-radius: 0.375rem; font-size: 0.875rem;">
            </div>
            <button type="submit" 
                    class="btn" 
                    style="padding: 0.5rem 1.5rem; background: #9FCFC0; color: white; border-radius: 0.375rem; border: none; cursor: pointer; font-size: 0.875rem; font-weight: 500; white-space: nowrap;">
                Upload
            </button>
        </div>
    </form>
    {% endif %}
</div>