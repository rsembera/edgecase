{% extends "base.html" %}

{% block title %}{{ 'Edit' if type else 'Add' }} Client Type - EdgeCase Equalizer{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/add_edit_type.css') }}">
{% endblock %}

{% block content %}
<div class="card">
    <h2>{{ 'Edit' if type else 'Add' }} Client Type</h2>
    <p style="color: #5B6571; margin-top: 0.5rem;">Client types are for filtering and organizing your client list</p>

    {% if error %}
    <div style="background: #FEE2E2; border: 2px solid #EF4444; color: #991B1B; padding: 1rem; border-radius: 0.5rem; margin-bottom: 1.5rem;">
        {{ error }}
    </div>
    {% endif %}
    
    <form method="POST" id="type-form"
          data-type-id="{{ type.id if type else '' }}"
          data-retention-days="{{ type.retention_period if type and type.retention_period else 0 }}">
        
        <div class="form-group">
            <label for="name">Type Name</label>
            <input type="text" id="name" name="name" 
                   value="{{ type.name if type else '' }}" 
                   maxlength="9" required
                   placeholder="Max 9 characters">
            <small style="color: #5B6571; display: block; margin-top: 0.25rem;">
                Keep it short for clean badge display (e.g., "Active", "Reduced", "Waitlist")
            </small>
        </div>
        
        <div class="form-group">
            <label>Colour</label>
            <div class="color-picker">
                {% for color in colors %}
                <div class="color-option {% if type and type.color == color.hex %}selected{% endif %}" 
                     data-hex="{{ color.hex }}"
                     data-name="{{ color.name }}"
                     data-bubble="{{ color.bubble }}">
                    <div class="color-swatch" style="background-color: {{ color.hex }}">
                        {{ color.name }}
                    </div>
                    <div class="checkmark">âœ“</div>
                </div>
                {% endfor %}
            </div>
            <input type="hidden" id="color" name="color" value="{{ type.color if type else '#9FCFC0' }}">
            <input type="hidden" id="color_name" name="color_name" value="{{ type.color_name if type else 'Soft Teal' }}">
            <input type="hidden" id="bubble_color" name="bubble_color" value="{{ type.bubble_color if type else '#E0F2EE' }}">
        </div>
        
        <div class="form-group">
            <label for="retention_value">Retention Period</label>
            <div style="display: flex; gap: 0.5rem;">
                <input type="number" id="retention_value" name="retention_value" 
                       min="0" style="flex: 2;"
                       value="{{ retention_value if type else '' }}"
                       placeholder="1"
                       required>
                <select id="retention_unit" name="retention_unit" style="flex: 1;">
                    <option value="days" {% if retention_unit == 'days' %}selected{% endif %}>Days</option>
                    <option value="months" {% if retention_unit == 'months' or (type and not retention_unit) %}selected{% endif %}>Months</option>
                    <option value="years" {% if retention_unit == 'years' %}selected{% endif %}>Years</option>
                </select>
            </div>
            <small style="color: #5B6571; display: block; margin-top: 0.25rem;">
                How long to keep inactive client records (e.g., 12 months, 7 years)
            </small>
        </div>
        
        <div class="form-actions">
            <a href="{{ url_for('manage_types') }}" class="btn btn-secondary">Cancel</a>
            
            <div style="display: flex; gap: 1rem;">
                {% if type and not type.is_system_locked %}
                <button type="button" class="btn btn-delete" id="delete-btn">Delete Type</button>
                {% endif %}
                <button type="submit" class="btn btn-primary">
                    {{ 'Save Changes' if type else 'Create Type' }}
                </button>
            </div>
        </div>
    </form>
</div>

<!-- Delete confirmation modal -->
<div id="deleteModal" class="modal-overlay">
    <div class="modal">
        <h3>Delete Client Type?</h3>
        <p>Are you sure you want to delete this type? This action cannot be undone.</p>
        <div class="modal-actions">
            <button type="button" class="btn btn-secondary" id="cancel-delete">Cancel</button>
            <button type="button" class="btn btn-delete" id="confirm-delete">Delete Type</button>
        </div>
    </div>
</div>

<!-- Error Modal -->
<div id="errorModal" class="modal-overlay">
    <div class="modal" style="border-top: 4px solid #e53e3e;">
        <h3 style="color: #2d3748; margin-bottom: 1rem;">Cannot Delete Type</h3>
        <p id="error-message" style="color: #4a5568; margin-bottom: 1.5rem; line-height: 1.6;"></p>
        <div class="modal-actions">
            <button type="button" class="btn" id="close-error" style="width: 100%;">OK</button>
        </div>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/add_edit_type.js') }}"></script>
{% endblock %}