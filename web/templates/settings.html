{% extends "base.html" %}

{% block title %}Settings - EdgeCase Equalizer{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/settings.css') }}">

<style>
/* Collapsible section styles */
.settings-section-collapsible {
    background: #FBFCFD;
    border-radius: 1rem;
    margin-bottom: 1rem;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    overflow: hidden;
}

.settings-section-header {
    display: flex;
    align-items: flex-start;
    gap: 1rem;
    padding: 1.5rem 2rem;
    cursor: pointer;
    user-select: none;
    list-style: none;
    transition: background-color 0.2s;
}

.settings-section-header:hover {
    background-color: #F2F4F5;
}

.settings-section-header::-webkit-details-marker {
    display: none;
}

.settings-section-header .arrow {
    font-size: 0.875rem;
    color: #6B7280;
    transition: transform 0.2s;
    flex-shrink: 0;
    line-height: 1.875rem;
}

details[open] .settings-section-header .arrow {
    transform: rotate(90deg);
}

.settings-section-header h3 {
    margin: 0;
    font-size: 1.5rem;
    color: #1F2937;
    font-weight: 700;
}

.settings-section-header p {
    margin: 0.25rem 0 0 0;
    color: #6B7280;
    font-size: 0.9375rem;
}

.settings-section-content {
    padding: 0 2rem 2rem 2rem;
}
</style>

{% endblock %}

{% block content %}
<div class="card">
    <h2>Settings</h2>
    <p style="color: #5B6571; margin-top: 0.5rem; margin-bottom: 2rem;">Customize your EdgeCase experience</p>
    
    <div id="success-message" class="success-message">
        ‚úì Settings saved successfully!
    </div>
    
    <!-- Appearance Section -->
    <details class="settings-section-collapsible">
        <summary class="settings-section-header">
            <span class="arrow">‚ñ∂</span>
            <div>
                <h3>Appearance</h3>
                <p>Customize how EdgeCase looks</p>
            </div>
        </summary>
        <div class="settings-section-content">
        
        <div class="form-group">
            <label for="card-style">Info Card Style</label>
            <select id="card-style" onchange="saveAndApplyCardStyle()">
                <option value="strait-laced">Strait-Laced (White cards)</option>
                <option value="tutti-frutti">Tutti-Frutti (Colored cards)</option>
            </select>
        </div>
        
        <div class="form-group">
            <label for="background-style">Background</label>
            <select id="background-style" onchange="saveAndApplyBackground()">
                <option value="suit-grey">Suit Grey (Solid)</option>
                <!-- Background images will be added by JavaScript -->
            </select>
            <button onclick="deleteBackground()" id="delete-bg-button" class="btn" style="padding: 0.5rem 1rem; font-size: 0.875rem; margin-left: 0.5rem; display: none; background: #E7CFD4; color: #6A243E;">
                üóëÔ∏è Delete
            </button>
        </div>
        
        <div class="form-group">
            <label for="background-upload">Upload New Background</label>
            <input type="file" id="background-upload" accept="image/*" style="display: none;">
            <button onclick="document.getElementById('background-upload').click()" class="btn" style="padding: 0.5rem 1rem; font-size: 0.875rem;">
                Choose Image
            </button>
            <span id="upload-filename" style="margin-left: 1rem; color: #5B6571; font-size: 0.875rem;"></span>
            <button onclick="uploadBackground()" id="upload-button" class="btn" style="padding: 0.5rem 1rem; font-size: 0.875rem; margin-left: 0.5rem; display: none;">
                Upload
            </button>
        </div>
        
        <div id="upload-status" style="color: #0E5346; font-size: 0.875rem; margin-top: 0.5rem; display: none;"></div>
        </div>
    </details>
    
    <!-- Card Layout Section -->
    <details class="settings-section-collapsible">
        <summary class="settings-section-header">
            <span class="arrow">‚ñ∂</span>
            <div>
                <h3>Card Layout</h3>
                <p>Arrange your info cards in your preferred order</p>
            </div>
        </summary>
        <div class="settings-section-content">
        
        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; margin-bottom: 1rem;">
            <div class="form-group" style="margin-bottom: 0;">
                <label for="position-1">Position 1 (Top Left)</label>
                <select id="position-1" onchange="handleCardSwap(0)">
                    <option value="active-clients">Active Clients</option>
                    <option value="sessions-week">Sessions This Week</option>
                    <option value="pending-invoices">Pending Invoices</option>
                    <option value="billable-month">Billable This Month</option>
                    <option value="current-time">Current Time</option>
                    <option value="navigation">Navigation</option>
                </select>
            </div>
            
            <div class="form-group" style="margin-bottom: 0;">
                <label for="position-2">Position 2 (Top Center)</label>
                <select id="position-2" onchange="handleCardSwap(1)">
                    <option value="active-clients">Active Clients</option>
                    <option value="sessions-week">Sessions This Week</option>
                    <option value="pending-invoices">Pending Invoices</option>
                    <option value="billable-month">Billable This Month</option>
                    <option value="current-time">Current Time</option>
                    <option value="navigation">Navigation</option>
                </select>
            </div>
            
            <div class="form-group" style="margin-bottom: 0;">
                <label for="position-3">Position 3 (Top Right)</label>
                <select id="position-3" onchange="handleCardSwap(2)">
                    <option value="active-clients">Active Clients</option>
                    <option value="sessions-week">Sessions This Week</option>
                    <option value="pending-invoices">Pending Invoices</option>
                    <option value="billable-month">Billable This Month</option>
                    <option value="current-time">Current Time</option>
                    <option value="navigation">Navigation</option>
                </select>
            </div>
        </div>
        
        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem;">
            <div class="form-group" style="margin-bottom: 0;">
                <label for="position-4">Position 4 (Bottom Left)</label>
                <select id="position-4" onchange="handleCardSwap(3)">
                    <option value="active-clients">Active Clients</option>
                    <option value="sessions-week">Sessions This Week</option>
                    <option value="pending-invoices">Pending Invoices</option>
                    <option value="billable-month">Billable This Month</option>
                    <option value="current-time">Current Time</option>
                    <option value="navigation">Navigation</option>
                </select>
            </div>
            
            <div class="form-group" style="margin-bottom: 0;">
                <label for="position-5">Position 5 (Bottom Center)</label>
                <select id="position-5" onchange="handleCardSwap(4)">
                    <option value="active-clients">Active Clients</option>
                    <option value="sessions-week">Sessions This Week</option>
                    <option value="pending-invoices">Pending Invoices</option>
                    <option value="billable-month">Billable This Month</option>
                    <option value="current-time">Current Time</option>
                    <option value="navigation">Navigation</option>
                </select>
            </div>
            
            <div class="form-group" style="margin-bottom: 0;">
                <label for="position-6">Position 6 (Bottom Right)</label>
                <select id="position-6" onchange="handleCardSwap(5)">
                    <option value="active-clients">Active Clients</option>
                    <option value="sessions-week">Sessions This Week</option>
                    <option value="pending-invoices">Pending Invoices</option>
                    <option value="billable-month">Billable This Month</option>
                    <option value="current-time">Current Time</option>
                    <option value="navigation">Navigation</option>
                </select>
            </div>
        </div>
        </div>
    </details>
    
    <!-- Practice Information Section -->
    <details class="settings-section-collapsible">
        <summary class="settings-section-header">
            <span class="arrow">‚ñ∂</span>
            <div>
                <h3>Practice Information</h3>
                <p>Your contact details and branding (used on invoices)</p>
            </div>
        </summary>
        <div class="settings-section-content">
        
        <div class="form-group">
            <label for="practice-name">Practice Name</label>
            <input type="text" id="practice-name" placeholder="e.g., Mindful Pathways Counselling">
        </div>
        
        <div class="form-group">
            <label for="therapist-name">Therapist Name</label>
            <input type="text" id="therapist-name" placeholder="e.g., Dr. Jane Smith">
        </div>
        
        <div class="form-group">
            <label for="credentials">Credentials</label>
            <input type="text" id="credentials" placeholder="e.g., MSW, RSW, PhD">
        </div>
        
        <div class="form-group">
            <label for="practice-email">Email</label>
            <input type="email" id="practice-email" placeholder="e.g., contact@practice.com">
        </div>
        
        <div class="form-group">
            <label for="practice-phone">Phone</label>
            <input type="tel" id="practice-phone" placeholder="(123) 456-7890">
        </div>
        
        <div class="form-group">
            <label for="practice-address">Practice Address</label>
            <textarea id="practice-address" rows="5" placeholder="123 Main Street&#10;Suite 200&#10;Ottawa, ON K1A 0B1&#10;Canada"></textarea>
        </div>
        
        <div class="form-group">
            <label for="website">Website (optional)</label>
            <input type="url" id="website" placeholder="e.g., https://practice.com">
        </div>

        <div class="form-group">
            <label for="currency">Currency</label>
            <select id="currency">
                <option value="CAD">$ CAD - Canadian Dollar</option>
                <option value="USD">$ USD - US Dollar</option>
                <option value="EUR">‚Ç¨ EUR - Euro</option>
                <option value="GBP">¬£ GBP - British Pound</option>
                <option value="AUD">$ AUD - Australian Dollar</option>
                <option value="INR">‚Çπ INR - Indian Rupee</option>
                <option value="JPY">¬• JPY - Japanese Yen</option>
            </select>
        </div>
        
        <div class="form-group">
            <label>Consultation Fee</label>
            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; max-width: 600px;">
                <div>
                    <label for="consultation-base" style="font-size: 0.875rem; color: #6B7280; font-weight: normal;">Base Fee ($)</label>
                    <input type="number" 
                           id="consultation-base" 
                           step="0.01" 
                           min="0" 
                           placeholder="0.00"
                           oninput="calculateConsultationFee('base')">
                </div>
                <div>
                    <label for="consultation-tax" style="font-size: 0.875rem; color: #6B7280; font-weight: normal;">Tax Rate (%)</label>
                    <input type="number" 
                           id="consultation-tax" 
                           step="0.01" 
                           min="0" 
                           max="100"
                           placeholder="0.00"
                           oninput="calculateConsultationFee('tax')">
                </div>
                <div>
                    <label for="consultation-total" style="font-size: 0.875rem; color: #6B7280; font-weight: normal;">Total Fee ($)</label>
                    <input type="number" 
                           id="consultation-total" 
                           step="0.01" 
                           min="0" 
                           placeholder="0.00"
                           oninput="calculateConsultationFee('total')">
                </div>
            </div>
        </div>
        
        <div class="form-group">
            <label for="consultation-duration">Consultation Duration</label>
            <select id="consultation-duration" style="max-width: 200px;">
                <option value="15">15 minutes</option>
                <option value="20">20 minutes</option>
                <option value="25">25 minutes</option>
                <option value="30">30 minutes</option>
                <option value="35">35 minutes</option>
                <option value="40">40 minutes</option>
                <option value="45">45 minutes</option>
                <option value="50">50 minutes</option>
                <option value="55">55 minutes</option>
                <option value="60">60 minutes</option>
            </select>
        </div>
        
        <div class="form-group">
        <label for="logo-upload">Practice Logo</label>
        <div style="display: flex; align-items: center; gap: 0.5rem;">
            <input type="file" id="logo-upload" accept="image/*" style="display: none;">
            <button onclick="document.getElementById('logo-upload').click()" class="btn" style="padding: 0.5rem 1rem; font-size: 0.875rem;">
                Choose Logo
            </button>
            <span id="logo-filename" style="margin-left: 0.5rem; color: #5B6571; font-size: 0.875rem;"></span>
            <button onclick="uploadLogo()" id="logo-upload-button" class="btn" style="padding: 0.5rem 1rem; font-size: 0.875rem; display: none;">
                Upload
            </button>
            <span id="logo-current" style="margin-left: 0.5rem; color: #0E5346; font-size: 0.875rem;"></span>
            <button onclick="deleteLogo()" id="logo-delete-button" class="btn" style="padding: 0.5rem 1rem; font-size: 0.875rem; display: none; background: #E7CFD4; color: #6A243E;">
                üóëÔ∏è Delete
            </button>
        </div>
    </div>
        
        <div class="form-group">
        <label for="signature-upload">Digital Signature</label>
        <div style="display: flex; align-items: center; gap: 0.5rem;">
            <input type="file" id="signature-upload" accept="image/*" style="display: none;">
            <button onclick="document.getElementById('signature-upload').click()" class="btn" style="padding: 0.5rem 1rem; font-size: 0.875rem;">
                Choose Signature
            </button>
            <span id="signature-filename" style="margin-left: 0.5rem; color: #5B6571; font-size: 0.875rem;"></span>
            <button onclick="uploadSignature()" id="signature-upload-button" class="btn" style="padding: 0.5rem 1rem; font-size: 0.875rem; display: none;">
                Upload
            </button>
            <span id="signature-current" style="margin-left: 0.5rem; color: #0E5346; font-size: 0.875rem;"></span>
            <button onclick="deleteSignature()" id="signature-delete-button" class="btn" style="padding: 0.5rem 1rem; font-size: 0.875rem; display: none; background: #E7CFD4; color: #6A243E;">
                üóëÔ∏è Delete
            </button>
        </div>
    </div>
        
        <div id="practice-info-status" style="color: #0E5346; font-size: 0.875rem; margin-top: 0.5rem; display: none;"></div>
        </div>
    </details>

    
    <!-- File Number Format Section -->
    <details class="settings-section-collapsible">
        <summary class="settings-section-header">
            <span class="arrow">‚ñ∂</span>
            <div>
                <h3>File Number Format</h3>
                <p>Choose how client file numbers are generated</p>
            </div>
        </summary>
        <div class="settings-section-content">
        
        <div class="form-group">
            <label for="file-number-format">Format Type</label>
            <select id="file-number-format" onchange="toggleFileNumberFields()">
                <option value="manual">Manual Entry - User types file number</option>
                <option value="date-initials">Auto: Date + Initials (YYYYMMDD-ABC)</option>
                <option value="prefix-counter">Auto: Prefix + Counter + Suffix</option>
            </select>
        </div>
        
        <!-- Options for Prefix-Counter format -->
        <div id="prefix-counter-options" style="display: none; margin-left: 2rem; padding: 1rem; background: #F2F4F5; border-radius: 0.5rem;">
            <div class="form-group">
                <label for="file-number-prefix">Prefix (optional)</label>
                <input type="text" id="file-number-prefix" placeholder="e.g., CLI or 2025" maxlength="6" style="max-width: 200px;">
                <small>Up to 6 characters</small>
            </div>
            
            <div class="form-group">
                <label for="file-number-suffix">Suffix (optional)</label>
                <input type="text" id="file-number-suffix" placeholder="e.g., A or -ON" maxlength="4" style="max-width: 200px;">
                <small>Up to 4 characters</small>
            </div>
            
            <div class="form-group">
                <label for="file-number-start">Starting Number</label>
                <input type="number" id="file-number-start" value="1" min="1" style="max-width: 200px;">
                <small>Counter starts here and increments automatically</small>
            </div>
            
            <div class="form-group" style="margin-bottom: 0;">
                <label>Preview</label>
                <div id="file-number-preview" style="font-family: monospace; font-size: 1.125rem; color: #111827; padding: 0.75rem; background: white; border: 2px solid #DEE2E6; border-radius: 0.5rem; max-width: 300px;">
                    0001
                </div>
                <small>Total length must not exceed 12 characters</small>
            </div>
        </div>
        
        <div id="file-number-status" style="color: #0E5346; font-size: 0.875rem; margin-top: 0.5rem; display: none;"></div>
        </div>
    </details>
    
    <div class="button-group">
        <a href="{{ url_for('clients.index') }}" class="btn btn-secondary">Cancel</a>
        <button onclick="saveSettings()" class="btn">Save Settings</button>
    </div>

    <div style="text-align: center; margin-top: 3rem; padding-top: 2rem; border-top: 1px solid #e2e8f0;">
        <a href="javascript:void(0);" onclick="showAboutModal()" style="color: #6B7280; font-size: 0.875rem; text-decoration: none;">
            About EdgeCase Equalizer
        </a>
    </div>

    <!-- Confirmation Modal -->
    <div id="confirm-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.4); z-index: 10000; align-items: center; justify-content: center;">
        <div style="background: white; padding: 2rem; border-radius: 1rem; max-width: 350px; text-align: center; box-shadow: 0 4px 20px rgba(0,0,0,0.15);">
            <h2 id="confirm-title" style="color: #1F2937; margin-bottom: 0.75rem; font-size: 1.375rem; font-weight: 700;">Confirm Delete</h2>
            <p id="confirm-message" style="color: #6B7280; margin-bottom: 1.5rem; font-size: 0.9375rem;">Are you sure?</p>
            <div style="display: flex; gap: 0.75rem;">
                <button onclick="closeConfirmModal()" style="flex: 1; padding: 0.75rem 1.5rem; background: #E2E8F0; color: #4A5568; border: none; border-radius: 0.75rem; font-size: 0.9375rem; font-weight: 600; cursor: pointer; font-family: 'Lexend', sans-serif;">
                    Cancel
                </button>
                <button id="confirm-ok-button" style="flex: 1; padding: 0.75rem 1.5rem; background: #E7CFD4; color: #6A243E; border: none; border-radius: 0.75rem; font-size: 0.9375rem; font-weight: 600; cursor: pointer; font-family: 'Lexend', sans-serif;">
                    Delete
                </button>
            </div>
        </div>
    </div>

    <!-- About Modal -->
    <div id="about-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.4); z-index: 10000; align-items: center; justify-content: center;">
        <div style="background: white; padding: 2rem; border-radius: 1rem; max-width: 450px; text-align: center; box-shadow: 0 4px 20px rgba(0,0,0,0.15);">
            <img src="{{ url_for('static', filename='assets/logo.png') }}" alt="EdgeCase Logo" style="width: 150px; margin-bottom: 1rem;">
            <h2 style="color: #1F2937; margin-bottom: 0.5rem; font-size: 1.5rem; font-weight: 700;">EdgeCase Equalizer</h2>
            <p style="color: #00AA88; margin-bottom: 0.5rem; font-size: 1rem; font-weight: 600;">v1.0 Simak</p>
            <p style="color: #6B7280; margin-bottom: 0.25rem; font-size: 0.875rem;">Designed by Richard Sembera</p>
            <p style="color: #6B7280; margin-bottom: 1.5rem; font-size: 0.875rem;">Coded by Claude Sonnet 4.5</p>
            <p style="color: #4A5568; font-style: italic; margin-bottom: 1.5rem; font-size: 0.9375rem;">"Every practice is an edge case."</p>
            <button onclick="closeAboutModal()" style="padding: 0.75rem 1.5rem; background: #BFDCDC; color: #115D4F; border: none; border-radius: 0.75rem; font-size: 0.9375rem; font-weight: 600; cursor: pointer; width: 100%; font-family: 'Lexend', sans-serif;">
                Close
            </button>
        </div>
    </div>

</div>

{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/settings.js') }}"></script>
{% endblock %}