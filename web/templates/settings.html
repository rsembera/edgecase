{% extends "base.html" %}

{% block title %}Settings - EdgeCase Equalizer{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/settings.css') }}">

<style>
/* Collapsible section styles */
.settings-section-collapsible {
    background: #FBFCFD;
    border-radius: 1rem;
    margin-bottom: 1rem;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    overflow: visible;
    position: relative;
    z-index: 1;
}

/* Ensure open sections have higher z-index so dropdowns appear above closed sections */
details[open].settings-section-collapsible {
    z-index: 10;
}

.settings-section-header {
    display: flex;
    align-items: flex-start;
    gap: 1rem;
    padding: 1.5rem 2rem;
    cursor: pointer;
    user-select: none;
    list-style: none;
    transition: background-color 0.2s;
}

.settings-section-header:hover {
    background-color: #F2F4F5;
}

.settings-section-header::-webkit-details-marker {
    display: none;
}

.settings-section-header .arrow {
    font-size: 0.875rem;
    color: var(--color-text-muted);
    transition: transform 0.2s;
    flex-shrink: 0;
    line-height: 1.875rem;
}

details[open] .settings-section-header .arrow {
    transform: rotate(90deg);
}

.settings-section-header h3 {
    margin: 0;
    font-size: 1.5rem;
    color: #1F2937;
    font-weight: 700;
}

.settings-section-header p {
    margin: 0.25rem 0 0 0;
    color: var(--color-text-muted);
    font-size: 0.9375rem;
}

.settings-section-content {
    padding: 0 2rem 2rem 2rem;
}

.btn-spinner {
    display: inline-block;
    animation: spin 1s linear infinite;
}

.btn-spinner.hidden {
    display: none;
}

@keyframes spin {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
}

.alert-warning {
    background: #FEF3C7;
    color: #92400E;
    border: 1px solid #FDE68A;
    padding: 1rem;
    border-radius: 0.5rem;
    margin-bottom: 1rem;
}

/* Section save row - button and status on same line */
.section-save-row {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin-top: 1.5rem;
    padding-top: 1rem;
    border-top: 1px solid #E5E7EB;
}

.section-status {
    color: #0E5346;
    font-size: 0.875rem;
    opacity: 0;
    transition: opacity 0.3s;
}

.section-status.show {
    opacity: 1;
}

/* Font preview styling */
.font-preview {
    margin-top: 0.5rem;
    padding: 0.75rem 1rem;
    background: #F9FAFB;
    border-radius: 0.5rem;
    border: 1px solid #E5E7EB;
}

.font-preview-lexend {
    font-family: 'Lexend', sans-serif;
}

.font-preview-inter {
    font-family: 'Inter', sans-serif;
}

.font-preview-lora {
    font-family: 'Lora', serif;
}
</style>

{% endblock %}

{% block content %}
<div class="card">
    <h2><i data-lucide="sliders-horizontal" class="page-icon"></i>Settings</h2>
    <p class="page-subtitle">Customize your EdgeCase experience</p>
    
    <!-- Appearance Section -->
    <details class="settings-section-collapsible">
        <summary class="settings-section-header">
            <span class="arrow">▶</span>
            <div>
                <h3>Appearance</h3>
                <p>Customize how EdgeCase looks</p>
            </div>
        </summary>
        <div class="settings-section-content">
        
        <div class="form-row-half">
            <div class="form-group">
                <label for="ui-font">Interface Font</label>
                <select id="ui-font" onchange="saveAndApplyFont()">
                    <option value="lexend">Lexend (Modern, clean)</option>
                    <option value="inter">Inter (Highly readable)</option>
                    <option value="lora">Lora (Elegant serif)</option>
                </select>
                <div id="font-preview" class="font-preview">
                    The quick brown fox jumps over the lazy dog.
                </div>
            </div>
        </div>
        
        <div class="form-row-half">
            <div class="form-group">
                <label for="card-style">Info Card Style</label>
                <select id="card-style" onchange="saveAndApplyCardStyle()">
                    <option value="strait-laced">Strait-Laced (White)</option>
                    <option value="garden-path">Garden Path (Green/sage)</option>
                    <option value="ocean-breeze">Ocean Breeze (Blue/teal)</option>
                    <option value="sunset-glow">Sunset Glow (Warm peach)</option>
                    <option value="tutti-frutti">Tutti-Frutti (Mixed pastels)</option>
                </select>
            </div>
        </div>
        
        <div class="grid-2col mb-half">
            <div class="form-group mb-0">
                <label for="background-style">Background</label>
                <select id="background-style" onchange="saveAndApplyBackground()">
                    <option value="suit-grey">Suit Grey (Cool grey)</option>
                    <option value="sage-mist">Sage Mist (Soft green)</option>
                    <option value="soft-cream">Soft Cream (Warm cream)</option>
                    <option value="warm-stone">Warm Stone (Taupe)</option>
                    <!-- Background images will be added by JavaScript -->
                </select>
            </div>
        </div>
        
        <div class="mb-1-5">
            <button onclick="deleteBackground()" id="delete-bg-button" class="btn btn-sm btn-danger-light">
                <i data-lucide="trash-2" class="icon-sm icon-inline"></i>Delete Background
            </button>
        </div>
        
        <div class="form-group">
            <label for="background-upload">Upload New Background</label>
            <input type="file" id="background-upload" accept="image/*" style="display: none;">
            <button onclick="document.getElementById('background-upload').click()" class="btn btn-sm">
                Choose Image
            </button>
            <span id="upload-filename" class="text-muted text-sm ml-1"></span>
            <button onclick="uploadBackground()" id="upload-button" class="btn btn-sm ml-half hidden">
                Upload
            </button>
        </div>
        
        <div id="upload-status" style="color: #0E5346; font-size: 0.875rem; margin-top: 0.5rem; display: none;"></div>
        </div>
    </details>
    
    <!-- Date & Time Section -->
    <details class="settings-section-collapsible">
        <summary class="settings-section-header">
            <span class="arrow">▶</span>
            <div>
                <h3>Date & Time</h3>
                <p>Set your preferred time format</p>
            </div>
        </summary>
        <div class="settings-section-content">
        
        <div class="form-row-half">
            <div class="form-group mb-0">
                <label for="time-format">Time Format</label>
                <select id="time-format" onchange="saveTimeFormat()">
                    <option value="12h">12-hour (2:30 PM)</option>
                    <option value="24h">24-hour (14:30)</option>
                </select>
                <p class="text-muted text-sm mt-half">This affects how times are displayed in entries and auto-generated communications.</p>
            </div>
        </div>
        
        <span id="time-format-status" class="section-status">✓ Saved!</span>
        </div>
    </details>
    
    <!-- Card Layout Section -->
    <details class="settings-section-collapsible">
        <summary class="settings-section-header">
            <span class="arrow">▶</span>
            <div>
                <h3>Card Layout</h3>
                <p>Arrange your info cards in your preferred order</p>
            </div>
        </summary>
        <div class="settings-section-content">
        
        <div class="grid-3col mb-1">
            <div class="form-group mb-0">
                <label for="position-1">Position 1 (Top Left)</label>
                <select id="position-1" onchange="handleCardSwap(0)">
                    <option value="active-clients">Active Clients</option>
                    <option value="sessions-month">Sessions This Month</option>
                    <option value="pending-invoices">Pending Invoices</option>
                    <option value="billable-month">Billable This Month</option>
                    <option value="current-time">Current Time</option>
                    <option value="navigation">Navigation</option>
                </select>
            </div>
            
            <div class="form-group mb-0">
                <label for="position-2">Position 2 (Top Center)</label>
                <select id="position-2" onchange="handleCardSwap(1)">
                    <option value="active-clients">Active Clients</option>
                    <option value="sessions-month">Sessions This Month</option>
                    <option value="pending-invoices">Pending Invoices</option>
                    <option value="billable-month">Billable This Month</option>
                    <option value="current-time">Current Time</option>
                    <option value="navigation">Navigation</option>
                </select>
            </div>
            
            <div class="form-group mb-0">
                <label for="position-3">Position 3 (Top Right)</label>
                <select id="position-3" onchange="handleCardSwap(2)">
                    <option value="active-clients">Active Clients</option>
                    <option value="sessions-month">Sessions This Month</option>
                    <option value="pending-invoices">Pending Invoices</option>
                    <option value="billable-month">Billable This Month</option>
                    <option value="current-time">Current Time</option>
                    <option value="navigation">Navigation</option>
                </select>
            </div>
        </div>
        
        <div class="grid-3col">
            <div class="form-group mb-0">
                <label for="position-4">Position 4 (Bottom Left)</label>
                <select id="position-4" onchange="handleCardSwap(3)">
                    <option value="active-clients">Active Clients</option>
                    <option value="sessions-month">Sessions This Month</option>
                    <option value="pending-invoices">Pending Invoices</option>
                    <option value="billable-month">Billable This Month</option>
                    <option value="current-time">Current Time</option>
                    <option value="navigation">Navigation</option>
                </select>
            </div>
            
            <div class="form-group mb-0">
                <label for="position-5">Position 5 (Bottom Center)</label>
                <select id="position-5" onchange="handleCardSwap(4)">
                    <option value="active-clients">Active Clients</option>
                    <option value="sessions-month">Sessions This Month</option>
                    <option value="pending-invoices">Pending Invoices</option>
                    <option value="billable-month">Billable This Month</option>
                    <option value="current-time">Current Time</option>
                    <option value="navigation">Navigation</option>
                </select>
            </div>
            
            <div class="form-group mb-0">
                <label for="position-6">Position 6 (Bottom Right)</label>
                <select id="position-6" onchange="handleCardSwap(5)">
                    <option value="active-clients">Active Clients</option>
                    <option value="sessions-month">Sessions This Month</option>
                    <option value="pending-invoices">Pending Invoices</option>
                    <option value="billable-month">Billable This Month</option>
                    <option value="current-time">Current Time</option>
                    <option value="navigation">Navigation</option>
                </select>
            </div>
        </div>
        </div>
    </details>
    
    <!-- Practice Information Section -->
    <details class="settings-section-collapsible">
        <summary class="settings-section-header">
            <span class="arrow">▶</span>
            <div>
                <h3>Practice Information</h3>
                <p>Your contact details and branding (used on invoices)</p>
            </div>
        </summary>
        <div class="settings-section-content">
        
        <div class="form-group">
            <label for="practice-name">Practice Name</label>
            <input type="text" id="practice-name" placeholder="e.g., Mindful Pathways Counselling">
        </div>
        
        <div class="form-group">
            <label for="therapist-name">Therapist Name</label>
            <input type="text" id="therapist-name" placeholder="e.g., Dr. Jane Smith">
        </div>
        
        <div class="form-group">
            <label for="credentials">Credentials</label>
            <input type="text" id="credentials" placeholder="e.g., MSW, RSW, PhD">
        </div>
        
        <div class="form-group">
            <label for="practice-email">Email</label>
            <input type="email" id="practice-email" placeholder="e.g., contact@practice.com">
        </div>
        
        <div class="form-group">
            <label for="practice-phone">Phone</label>
            <input type="tel" id="practice-phone" placeholder="(123) 456-7890">
        </div>
        
        <div class="form-group">
            <label for="practice-address">Practice Address</label>
            <textarea id="practice-address" rows="5" placeholder="123 Main Street&#10;Suite 200&#10;Ottawa, ON K1A 0B1&#10;Canada"></textarea>
        </div>
        
        <div class="form-group">
            <label for="website">Website (optional)</label>
            <input type="url" id="website" placeholder="e.g., https://practice.com">
        </div>
        
        <div class="form-group">
            <label>Consultation Fee</label>
            <div class="grid-3col max-w-600">
                <div>
                    <label for="consultation-base" class="text-muted label-light">Base Fee</label>
                    <input type="number" 
                           id="consultation-base" 
                           step="0.01" 
                           min="0" 
                           placeholder="0.00"
                           oninput="calculateConsultationFee('base')">
                </div>
                <div>
                    <label for="consultation-tax" class="text-muted label-light">Tax Rate (%)</label>
                    <input type="number" 
                           id="consultation-tax" 
                           step="0.01" 
                           min="0" 
                           max="100"
                           placeholder="0.00"
                           oninput="calculateConsultationFee('tax')">
                </div>
                <div>
                    <label for="consultation-total" class="text-muted label-light">Total Fee</label>
                    <input type="number" 
                           id="consultation-total" 
                           step="0.01" 
                           min="0" 
                           placeholder="0.00"
                           oninput="calculateConsultationFee('total')">
                </div>
            </div>
        </div>
        
        <div class="form-group" style="max-width: 280px;">
            <label for="consultation-duration">Consultation Duration</label>
            <select id="consultation-duration">
                <option value="15">15 minutes</option>
                <option value="20">20 minutes</option>
                <option value="25">25 minutes</option>
                <option value="30">30 minutes</option>
                <option value="35">35 minutes</option>
                <option value="40">40 minutes</option>
                <option value="45">45 minutes</option>
                <option value="50">50 minutes</option>
                <option value="55">55 minutes</option>
                <option value="60">60 minutes</option>
            </select>
        </div>
        
        <div class="section-save-row">
            <button onclick="savePracticeInfo()" class="btn">Save</button>
            <span id="practice-info-status" class="section-status">✓ Saved!</span>
        </div>
        </div>
    </details>

    
    <!-- File Number Format Section -->
    <details class="settings-section-collapsible">
        <summary class="settings-section-header">
            <span class="arrow">▶</span>
            <div>
                <h3>File Number Format</h3>
                <p>Choose how client file numbers are generated</p>
            </div>
        </summary>
        <div class="settings-section-content">
        
        <div class="form-row-half">
        <div class="form-group">
            <label for="file-number-format">Format Type</label>
            <select id="file-number-format" onchange="handleFileNumberFormatChange()">
                <option value="manual">Manual Entry - User types file number</option>
                <option value="date-initials">Auto: Date + Initials (YYYYMMDD-ABC)</option>
                <option value="prefix-counter">Auto: Prefix + Counter + Suffix</option>
            </select>
        </div>
        </div>
        
        <!-- Options for Prefix-Counter format -->
        <div id="prefix-counter-options" class="options-panel" style="display: none;">
            <div class="form-group">
                <label for="file-number-prefix">Prefix (optional)</label>
                <input type="text" id="file-number-prefix" placeholder="e.g., CLI or 2025" maxlength="6" class="max-w-200" oninput="updateFileNumberPreview()">
                <small class="helper-text">Up to 6 characters</small>
            </div>
            
            <div class="form-group">
                <label for="file-number-suffix">Suffix (optional)</label>
                <input type="text" id="file-number-suffix" placeholder="e.g., A or -ON" maxlength="4" class="max-w-200" oninput="updateFileNumberPreview()">
                <small class="helper-text">Up to 4 characters</small>
            </div>
            
            <div class="form-group">
                <label for="file-number-start">Starting Number</label>
                <input type="number" id="file-number-start" value="1" min="1" class="max-w-200" oninput="updateFileNumberPreview()">
                <small class="helper-text">Counter starts here and increments automatically</small>
            </div>
            
            <div class="form-group mb-0">
                <label>Preview</label>
                <div id="file-number-preview" class="preview-box max-w-300">
                    0001
                </div>
                <small class="helper-text">Total length must not exceed 12 characters</small>
            </div>
            
            <div class="section-save-row">
                <button onclick="saveFileNumberSettings()" class="btn">Save</button>
                <span id="file-number-status" class="section-status"></span>
            </div>
        </div>
        
        <span id="file-number-format-status" class="section-status mt-1"></span>
        </div>
    </details>

    <!-- Calendar Section -->
    <details class="settings-section-collapsible">
        <summary class="settings-section-header">
            <span class="arrow">▶</span>
            <div>
                <h3>Calendar</h3>
                <p>How appointments are added to your calendar</p>
            </div>
        </summary>
        <div class="settings-section-content">
        
        <div class="form-row-half">
        <div class="form-group">
            <label for="calendar_method">Add appointments via</label>
            <select id="calendar_method" onchange="handleCalendarMethodChange()">
                <option value="ics">Download .ics file (works everywhere)</option>
                <option value="applescript">Add directly to Calendar (Mac only)</option>
            </select>
        </div>
        </div>
        
        <div id="calendar-applescript-options" style="display: none;">
            <div class="form-group">
                <label for="calendar_name">Calendar name</label>
                <input type="text" id="calendar_name" placeholder="e.g., Work, Clients, Calendar" class="mb-half">
                <small class="helper-text">Exact name of the calendar in Apple Calendar app</small>
            </div>
            
            <div class="section-save-row">
                <button onclick="saveCalendarSettings()" class="btn">Save</button>
                <span id="calendar-status" class="section-status">✓ Saved!</span>
            </div>
        </div>
        
        <span id="calendar-status-ics" class="section-status">✓ Saved!</span>
        </div>
    </details>
    
    <!-- Security Section -->
    <details class="settings-section-collapsible">
        <summary class="settings-section-header">
            <span class="arrow">▶</span>
            <div>
                <h3>Security</h3>
                <p>Database encryption and access control</p>
            </div>
        </summary>
        <div class="settings-section-content">
        
        <div class="form-group">
            <label>Database Encryption</label>
            <p class="status-paragraph">
                <i data-lucide="shield-check" class="icon-sm icon-inline"></i>
                Your database is encrypted with AES-256 (SQLCipher)
            </p>
        </div>
        
        <div class="form-group">
            <label>Master Password</label>
            <a href="{{ url_for('auth.change_password') }}" class="btn btn-sm">
                <i data-lucide="key" class="icon-sm icon-inline"></i>
                Change Password
            </a>
        </div>

        <div class="form-row-half">
        <div class="form-group mb-0">
            <label for="session_timeout">Auto-Logout After Inactivity</label>
            <select id="session_timeout" onchange="saveSecuritySettings()">
                <option value="15">15 minutes</option>
                <option value="30">30 minutes (default)</option>
                <option value="60">1 hour</option>
                <option value="120">2 hours</option>
                <option value="0">Never (not recommended)</option>
            </select>
            <small class="helper-text">For PHIPA compliance, shorter timeouts are recommended in shared spaces</small>
        </div>
        </div>
        
        <span id="security-status" class="section-status mt-1">✓ Saved!</span>
        </div>
    </details>



    <!-- AI Scribe Section -->
    <details class="settings-section-collapsible" id="ai-scribe">
        <summary class="settings-section-header">
            <span class="arrow">▶</span>
            <div>
                <h3>AI Scribe</h3>
                <p>Local AI assistant for session notes</p>
            </div>
        </summary>
        <div class="settings-section-content">
        
        <div id="ai-capability-status" class="mb-1"></div>
        
        <div id="ai-not-downloaded" style="display: none;">
            <p class="info-paragraph">AI Scribe uses a local language model (Hermes 3, ~5GB) to help you write professional clinical notes. The model runs entirely on your computer — no data is sent to external servers.</p>
            
            <div class="form-group">
                <button onclick="downloadAIModel()" id="ai-download-btn" class="btn">
                    <i data-lucide="download" class="icon-sm icon-inline"></i>
                    Download AI Model
                </button>
            </div>
            
            <div id="ai-download-progress" style="display: none; margin-top: 1rem;">
                <div class="download-status">
                    <i data-lucide="loader" class="btn-spinner icon-sm"></i>
                    <span id="ai-download-status">Starting download...</span>
                </div>
                <div class="progress-bar-container">
                    <div id="ai-download-bar" class="progress-bar-fill" style="width: 0%;"></div>
                </div>
                <p id="ai-download-size" class="text-muted text-xs mt-half"></p>
            </div>
        </div>
        
        <div id="ai-downloaded" style="display: none;">
            <p class="status-paragraph">
                <i data-lucide="check-circle" class="icon-sm icon-inline"></i>
                <span id="ai-model-info">Hermes 3 is installed</span>
            </p>
            
            <div id="ai-model-status" class="mb-1"></div>
            
            <div class="flex-gap-half flex-wrap">
                <button onclick="unloadAIModel()" id="ai-unload-btn" class="btn btn-sm">
                    <i data-lucide="power-off" class="icon-sm icon-inline"></i>
                    Unload from Memory
                </button>
                <button onclick="deleteAIModel()" id="ai-delete-btn" class="btn btn-sm btn-danger-light">
                    <i data-lucide="trash-2" class="icon-sm icon-inline"></i>
                    Delete Model
                </button>
            </div>
            
            <p class="text-muted text-sm mt-1">Access AI Scribe from the Session entry form using the <i data-lucide="feather" class="icon-sm icon-inline-no-mr"></i> button.</p>
        </div>
        
        </div>
    </details>

    <!-- Statements Section -->
    <details class="settings-section-collapsible">
        <summary class="settings-section-header">
            <span class="arrow">▶</span>
            <div>
                <h3>Statements</h3>
                <p>Invoice appearance and payment details</p>
            </div>
        </summary>
        <div class="settings-section-content">
        
        <div class="form-row-half">
        <div class="form-group">
            <label for="currency">Currency</label>
            <select id="currency">
                <option value="CAD">$ CAD - Canadian Dollar</option>
                <option value="USD">$ USD - US Dollar</option>
                <option value="EUR">€ EUR - Euro</option>
                <option value="GBP">£ GBP - British Pound</option>
                <option value="AUD">$ AUD - Australian Dollar</option>
                <option value="INR">₹ INR - Indian Rupee</option>
                <option value="JPY">¥ JPY - Japanese Yen</option>
            </select>
        </div>
        </div>
        
        <div class="form-group">
            <label for="registration_info">Registration Info</label>
            <input type="text" id="registration_info" placeholder="e.g., CRPO Registration Nr. #001234">
            <small class="helper-text">Appears in header next to your credentials</small>
        </div>
        
        <div class="form-group">
            <label for="payment_instructions">Payment Instructions</label>
            <textarea id="payment_instructions" rows="3" placeholder="e.g., Please send payment by e-transfer to: you@email.com" class="resize-v"></textarea>
            <small class="helper-text">Appears at bottom of statement</small>
        </div>
        
        <div class="form-group">
            <label class="checkbox-label-inline">
                <input type="checkbox" id="include_attestation" onchange="toggleAttestationText()" class="checkbox-auto">
                Include attestation statement
            </label>
        </div>
        
        <div class="form-group" id="attestation-text-group" style="display: none;">
            <label for="attestation_text">Attestation Text</label>
            <textarea id="attestation_text" rows="3" class="resize-v">I attest that I have performed the services listed above.</textarea>
        </div>
        
        <div class="form-row-half">
        <div class="form-group">
            <label for="email_method">Send statements via</label>
            <select id="email_method" onchange="toggleEmailFromField()">
                <option value="mailto">Open mailto: link (works everywhere)</option>
                <option value="applescript">Compose in Mail.app (Mac only, attaches PDF)</option>
            </select>
            <small class="helper-text">AppleScript method can automatically attach the PDF statement</small>
        </div>
        </div>  

        <div class="form-group" id="email-from-group" style="display: none;">
            <label for="email_from">Send From Address</label>
            <input type="email" id="email_from" placeholder="john.smith@geemail.com">
            <small class="helper-text">Must match an account configured in Apple Mail</small>
        </div>
        
        <div class="form-group">
            <label for="statement_email_body">Email Body Text</label>
            <textarea id="statement_email_body" rows="6" placeholder="If you have any questions or concerns, please don't hesitate to let me know.

All the best,

John Smith."></textarea>
            <small class="helper-text">Text that follows "Please find attached your statement for [Month Year]."</small>
        </div>
        
        <div class="form-group">
            <label>Practice Logo</label>
            <div class="flex-center-gap">
                <input type="file" id="logo-upload" accept="image/*" style="display: none;" onchange="uploadLogo()">
                <button type="button" id="logo-choose-button" onclick="document.getElementById('logo-upload').click()" class="btn btn-sm">
                    Choose Logo
                </button>
                <span id="logo-current" class="text-success text-sm"></span>
                <button type="button" onclick="deleteLogo()" id="logo-delete-button" class="btn btn-sm btn-danger-light">
                    <i data-lucide="trash-2" class="icon-sm icon-inline"></i>Delete
                </button>
            </div>
            <div id="logo-preview-container" class="image-preview-container" style="display: none;">
                <img id="logo-preview" src="" alt="Logo preview" class="image-preview">
            </div>
        </div>

        <div class="form-group">
            <label>Digital Signature</label>
            <div class="flex-center-gap">
                <input type="file" id="signature-upload" accept="image/*" style="display: none;" onchange="uploadSignature()">
                <button type="button" id="signature-choose-button" onclick="document.getElementById('signature-upload').click()" class="btn btn-sm">
                    Choose Signature
                </button>
                <span id="signature-current" class="text-success text-sm"></span>
                <button type="button" onclick="deleteSignature()" id="signature-delete-button" class="btn btn-sm btn-danger-light">
                    <i data-lucide="trash-2" class="icon-sm icon-inline"></i>Delete
                </button>
            </div>
            <div id="signature-preview-container" class="image-preview-container" style="display: none;">
                <img id="signature-preview" src="" alt="Signature preview" class="image-preview">
            </div>
        </div>
        
        <div class="section-save-row">
            <button onclick="saveStatementSettings()" class="btn">Save</button>
            <span id="statement-status" class="section-status">✓ Saved!</span>
        </div>
        </div>
    </details>

    <div class="text-right mt-2">
        <a href="{{ url_for('clients.index') }}" class="btn">
            <i data-lucide="arrow-left" class="icon-sm icon-inline"></i>
            Back
        </a>
    </div>

    <div class="footer-section">
        <a href="javascript:void(0);" onclick="showAboutModal()" class="about-link">
            About EdgeCase Equalizer
        </a>
    </div>

    <!-- Confirmation Modal -->
    <div id="confirm-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.4); z-index: 10000; align-items: center; justify-content: center;">
        <div style="background: white; padding: 2rem; border-radius: 1rem; max-width: 350px; text-align: center; box-shadow: 0 4px 20px rgba(0,0,0,0.15);">
            <h2 id="confirm-title" style="color: #1F2937; margin-bottom: 0.75rem; font-size: 1.375rem; font-weight: 700;">Confirm Delete</h2>
            <p id="confirm-message" style="color: #6B7280; margin-bottom: 1.5rem; font-size: 0.9375rem;">Are you sure?</p>
            <div style="display: flex; gap: 0.75rem;">
                <button onclick="closeConfirmModal()" style="flex: 1; padding: 0.75rem 1.5rem; background: #E2E8F0; color: #4A5568; border: none; border-radius: 0.75rem; font-size: 0.9375rem; font-weight: 600; cursor: pointer; font-family: var(--font-ui);">
                    Cancel
                </button>
                <button id="confirm-ok-button" style="flex: 1; padding: 0.75rem 1.5rem; background: #E7CFD4; color: #6A243E; border: none; border-radius: 0.75rem; font-size: 0.9375rem; font-weight: 600; cursor: pointer; font-family: var(--font-ui);">
                    Delete
                </button>
            </div>
        </div>
    </div>

    <!-- About Modal -->
    <div id="about-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.4); z-index: 10000; align-items: center; justify-content: center;">
        <div style="background: white; padding: 2rem; border-radius: 1rem; max-width: 450px; text-align: center; box-shadow: 0 4px 20px rgba(0,0,0,0.15);">
            <img src="{{ url_for('static', filename='assets/logo.png') }}" alt="EdgeCase Logo" style="width: 150px; margin-bottom: 1rem;">
            <h2 style="color: #1F2937; margin-bottom: 0.5rem; font-size: 1.5rem; font-weight: 700;">EdgeCase Equalizer</h2>
            <p style="color: #00AA88; margin-bottom: 0.5rem; font-size: 1rem; font-weight: 600;">v1.0 Simak</p>
            <p style="color: #6B7280; margin-bottom: 0.25rem; font-size: 0.875rem;">Designed by Richard Sembera</p>
            <p style="color: #6B7280; margin-bottom: 1.5rem; font-size: 0.875rem;">Coded by Claude Sonnet 4.5 and Opus 4.5</p>
            <p style="color: #4A5568; font-style: italic; margin-bottom: 1.5rem; font-size: 0.9375rem;">"Every practice is an edge case."</p>
            <button onclick="closeAboutModal()" style="padding: 0.75rem 1.5rem; background: #BFDCDC; color: #115D4F; border: none; border-radius: 0.75rem; font-size: 0.9375rem; font-weight: 600; cursor: pointer; width: 100%; font-family: var(--font-ui);">
                Close
            </button>
        </div>
    </div>

</div>

{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/settings.js') }}"></script>
{% endblock %}
