{% extends "base.html" %}

{% block title %}Settings - EdgeCase Equalizer{% endblock %}

{% block extra_css %}
<style>
    /* Muted palette styling for settings page */
    .card {
        background: #FBFCFD;
        border-radius: 1rem;
        padding: 2rem;
        box-shadow: 0 2px 8px rgba(0,0,0,0.06);
        max-width: 800px;
        margin: 0 auto;
    }
    
    h2 {
        color: #111827;
        margin-bottom: 0.5rem;
    }
    
    .settings-section {
        margin-bottom: 3rem;
        padding-bottom: 2rem;
        border-bottom: 1px solid #DEE2E6;
    }
    
    .settings-section:last-child {
        border-bottom: none;
        margin-bottom: 0;
        padding-bottom: 0;
    }
    
    .settings-section h3 {
        color: #111827;
        font-size: 1.25rem;
        margin-bottom: 0.5rem;
    }
    
    .settings-section p {
        color: #5B6571;
        margin-bottom: 1.5rem;
        font-size: 0.875rem;
    }
    
    .form-group {
        margin-bottom: 1.5rem;
    }
    
    label {
        display: block;
        margin-bottom: 0.5rem;
        font-weight: 600;
        color: #323B45;
        font-size: 0.875rem;
    }
    
    select {
        width: 100%;
        max-width: 400px;
        padding: 0.75rem;
        border: 2px solid #DEE2E6;
        border-radius: 0.5rem;
        font-size: 1rem;
        color: #111827;
        transition: all 0.2s;
        background: #FBFCFD;
    }
    
    select:focus {
        outline: none;
        border-color: #1F8F74;
        box-shadow: 0 0 0 3px rgba(31,143,116,0.06);
    }
    
    .btn {
        padding: 0.75rem 1.5rem;
        background: #BFDCDC;
        color: #115D4F;
        text-decoration: none;
        border-radius: 0.75rem;
        font-size: 0.875rem;
        font-weight: 600;
        transition: all 0.2s;
        display: inline-block;
        border: none;
        cursor: pointer;
        margin-right: 1rem;
    }
    
    .btn:hover {
        background: #9FCFC0;
        transform: translateY(-1px);
    }
    
    .button-group {
        display: flex;
        justify-content: space-between;
        gap: 1rem;
        margin-top: 2rem;
    }
    
    .success-message {
        background: #CFE7DA;
        color: #0E5346;
        padding: 1rem;
        border-radius: 0.5rem;
        margin-bottom: 1.5rem;
        display: none;
    }
    
    .success-message.show {
        display: block;
    }
</style>
{% endblock %}

{% block content %}
<div class="card">
    <h2>Settings</h2>
    <p style="color: #5B6571; margin-top: 0.5rem; margin-bottom: 2rem;">Customize your EdgeCase experience</p>
    
    <div id="success-message" class="success-message">
        ✓ Settings saved successfully!
    </div>
    
    <!-- Theme Settings Section -->
    <div class="settings-section">
        <h3>Appearance</h3>
        <p>Customize how EdgeCase looks</p>
        
        <div class="form-group">
            <label for="card-style">Info Card Style</label>
            <select id="card-style">
                <option value="strait-laced">Strait-Laced (White cards)</option>
                <option value="tutti-frutti">Tutti-Frutti (Colored cards)</option>
            </select>
        </div>
        
        <div class="form-group">
            <label for="background-style">Background</label>
            <select id="background-style">
                <option value="suit-grey">Suit Grey (Solid)</option>
                <!-- Background images will be added by JavaScript -->
            </select>
        </div>
    </div>
    
    <!-- Future Settings Sections -->
    <div class="settings-section">
        <h3>Practice Information</h3>
        <p>Manage your practice details, logo, and signature</p>
        <div style="color: #5B6571; font-style: italic;">Coming soon...</div>
    </div>
    
    <div class="settings-section">
        <h3>Defaults</h3>
        <p>Set default values for new clients and sessions</p>
        <div style="color: #5B6571; font-style: italic;">Coming soon...</div>
    </div>
    
    <div class="button-group">
        <a href="{{ url_for('index') }}" class="btn">← Back to Clients</a>
        <button onclick="saveSettings()" class="btn">Save Settings</button>
    </div>
</div>

<script>
// Load current settings on page load
function loadCurrentSettings() {
    const cardStyle = localStorage.getItem('cardStyle') || 'strait-laced';
    const backgroundStyle = localStorage.getItem('backgroundStyle') || 'suit-grey';
    
    document.getElementById('card-style').value = cardStyle;
    document.getElementById('background-style').value = backgroundStyle;
}

// Save settings
function saveSettings() {
    const cardStyle = document.getElementById('card-style').value;
    const backgroundStyle = document.getElementById('background-style').value;
    
    // Save to localStorage
    localStorage.setItem('cardStyle', cardStyle);
    localStorage.setItem('backgroundStyle', backgroundStyle);
    
    // Apply settings (applyTheme is defined in base.html)
    applyTheme();
    
    // Show success message
    const successMsg = document.getElementById('success-message');
    successMsg.classList.add('show');
    setTimeout(() => {
        successMsg.classList.remove('show');
    }, 3000);
}

// Load available background images
async function loadBackgroundOptions() {
    try {
        const response = await fetch('/api/backgrounds');
        const backgrounds = await response.json();
        
        // Create array of {filename, displayName} objects and sort by display name
        const backgroundOptions = backgrounds.map(bg => {
            const displayName = bg.replace(/\.[^/.]+$/, '').replace(/-/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
            return { filename: bg, displayName: displayName };
        });
        
        // Sort alphabetically by display name
        backgroundOptions.sort((a, b) => a.displayName.localeCompare(b.displayName));
        
        const select = document.getElementById('background-style');
        backgroundOptions.forEach(bg => {
            const option = document.createElement('option');
            option.value = bg.filename;
            option.textContent = bg.displayName;
            select.appendChild(option);
        });
        
        // Load current settings after options are populated
        loadCurrentSettings();
    } catch (error) {
        console.error('Failed to load background options:', error);
        loadCurrentSettings();
    }
}

// Initialize on page load
document.addEventListener('DOMContentLoaded', function() {
    loadBackgroundOptions();
});
</script>

{% endblock %}