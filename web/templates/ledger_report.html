{% extends "base.html" %}

{% block title %}Financial Report - EdgeCase Equalizer{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/ledger_report.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/pickers.css') }}">
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/pickers.js') }}"></script>
<script src="{{ url_for('static', filename='js/ledger_report.js') }}"></script>
{% endblock %}

{% block content %}
<div class="card card-narrow">
    <!-- Header -->
    <div class="report-header">
        <div>
            <h2><i data-lucide="file-bar-chart" class="page-icon"></i>Financial Report</h2>
            <p>Generate income and expense reports for tax filing</p>
        </div>
        <a href="{{ url_for('ledger.ledger') }}" class="btn">
            <i data-lucide="arrow-left" class="icon-btn"></i> Back
        </a>
    </div>
    
    <!-- Report Options -->
    <div class="report-options">
        <h3>Report Options</h3>
        
        <div class="form-row">
            <div class="form-group">
                <label>From</label>
                <div id="start-date-picker"></div>
                <input type="hidden" id="start_date" value="{{ default_start_year }}-{{ '%02d'|format(default_start_month) }}-{{ '%02d'|format(default_start_day) }}">
            </div>
            
            <div class="form-group">
                <label>To</label>
                <div id="end-date-picker"></div>
                <input type="hidden" id="end_date" value="{{ default_end_year }}-{{ '%02d'|format(default_end_month) }}-{{ '%02d'|format(default_end_day) }}">
            </div>
        </div>
        
        <div class="quick-ranges">
            <button type="button" class="btn-small" onclick="setYearRange({{ default_start_year - 1 }})">{{ default_start_year - 1 }}</button>
            <button type="button" class="btn-small" onclick="setYearRange({{ default_start_year }})">{{ default_start_year }}</button>
            <button type="button" class="btn-small" onclick="setYTD()">Year to Date</button>
        </div>
        
        <div class="checkbox-group">
            <label class="checkbox-label">
                <input type="checkbox" id="include-details" checked>
                <span>Include transaction details</span>
            </label>
            <p class="checkbox-hint">When checked, report includes a page listing all individual transactions. When unchecked, only the category summary is generated.</p>
        </div>
    </div>
    
    <!-- Preview Section -->
    <div class="report-preview">
        <h3>Preview</h3>
        <p class="preview-hint">Click "Calculate" to see totals before generating PDF.</p>
        
        <button type="button" class="btn" onclick="calculateTotals()">
            <i data-lucide="calculator" class="icon-btn"></i> Calculate
        </button>
        
        <div id="preview-results" style="display: none;">
            <div class="preview-summary">
                <div class="summary-item income">
                    <span class="summary-label">Total Income</span>
                    <span class="summary-value" id="preview-income">$0.00</span>
                </div>
                <div class="summary-item expenses">
                    <span class="summary-label">Total Expenses</span>
                    <span class="summary-value" id="preview-expenses">$0.00</span>
                </div>
                <div class="summary-item net">
                    <span class="summary-label">Net Income</span>
                    <span class="summary-value" id="preview-net">$0.00</span>
                </div>
            </div>
            
            <div class="category-breakdown" id="category-breakdown">
                <!-- Populated by JavaScript -->
            </div>
        </div>
    </div>
    
    <!-- Generate Button -->
    <div class="report-actions">
        <button type="button" class="btn" onclick="generateReport()">
            <i data-lucide="file-down" class="icon-btn"></i> Generate PDF
        </button>
    </div>
</div>

<!-- Hidden data for JavaScript -->
<script id="report-data" type="application/json">
{
    "defaultStartYear": {{ default_start_year }},
    "defaultStartMonth": {{ default_start_month }},
    "defaultStartDay": {{ default_start_day }},
    "defaultEndYear": {{ default_end_year }},
    "defaultEndMonth": {{ default_end_month }},
    "defaultEndDay": {{ default_end_day }}
}
</script>
{% endblock %}
